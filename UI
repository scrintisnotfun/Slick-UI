local WindUI = {}
WindUI.__index = WindUI

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- Helper: fast property application for Instance.new
local function fastNew(class, props)
	local obj = Instance.new(class)
	for k, v in pairs(props) do
        obj[k] = v
    end
	return obj
end

-- Icon mapping for string-based icons
local iconMap = {
	["star"] = "â­",
	["lightbulb"] = "ğŸ’¡",
	["home"] = "ğŸ ",
	["settings"] = "âš™ï¸",
	["user"] = "ğŸ‘¤",
	["search"] = "ğŸ”",
	["bell"] = "ğŸ””",
	["heart"] = "â¤ï¸",
	["shield"] = "ğŸ›¡ï¸",
	["crown"] = "ğŸ‘‘",
	["fire"] = "ğŸ”¥",
	["rocket"] = "ğŸš€",
	["trophy"] = "ğŸ†",
	["gift"] = "ğŸ",
	["music"] = "ğŸµ",
	["camera"] = "ğŸ“·",
	["book"] = "ğŸ“š",
	["globe"] = "ğŸŒ",
	["lock"] = "ğŸ”’",
	["key"] = "ğŸ”‘"
}

-- Modified getIcon to return nil if icon doesn't exist in map
local function getIcon(icon)
	if not icon then
		return nil
	end
	if iconMap[icon] then
		return iconMap[icon]
	end
	-- Check if it's already an emoji (unicode character)
	if icon:match("[%z\1-\127\194-\244][\128-\191]*") and #icon <= 4 then
		return icon
	end
	return nil -- Return nil if not found instead of the original string
end

-- Added function to create premium popup
local function createPremiumPopup(screenGui, mainFrame)
	-- Create backdrop
	local backdrop = fastNew("Frame", {
		Name = "PremiumPopupBackdrop",
		Size = UDim2.new(1, 0, 1, 0),
		BackgroundColor3 = Color3.fromRGB(0, 0, 0),
		BackgroundTransparency = 0.5,
		BorderSizePixel = 0,
		ZIndex = 1000,
		Parent = screenGui
	})
	
	-- Create popup frame - positioned relative to MainFrame
	local mainFrameCenter = mainFrame.AbsolutePosition + (mainFrame.AbsoluteSize / 2)
	local popup = fastNew("Frame", {
		Name = "PremiumPopup",
		Size = UDim2.new(0, 350, 0, 200),
		Position = UDim2.new(0, mainFrameCenter.X - 175, 0, mainFrameCenter.Y - 100),
		BackgroundColor3 = Color3.fromRGB(40, 40, 40),
		BorderSizePixel = 0,
		ZIndex = 1001,
		Parent = backdrop
	})
	
	fastNew("UICorner", {
		Name = "PopupCorner",
		CornerRadius = UDim.new(0, 12),
		Parent = popup
	})
	
	-- Title
	fastNew("TextLabel", {
		Name = "PopupTitle",
		Size = UDim2.new(1, -40, 0, 50),
		Position = UDim2.new(0, 20, 0, 20),
		BackgroundTransparency = 1,
		Text = "Premium Only!",
		TextColor3 = Color3.fromRGB(255, 200, 0),
		TextSize = 24,
		Font = Enum.Font.GothamBold,
		TextXAlignment = Enum.TextXAlignment.Center,
		ZIndex = 1002,
		Parent = popup
	})
	
	-- Lock icon
	fastNew("TextLabel", {
		Name = "PopupLockIcon",
		Size = UDim2.new(0, 40, 0, 40),
		Position = UDim2.new(0.5, -20, 0, 75),
		BackgroundTransparency = 1,
		Text = "ğŸ”’",
		TextSize = 32,
		ZIndex = 1002,
		Parent = popup
	})
	
	-- Copy Discord Link button
	local discordBtn = fastNew("TextButton", {
		Name = "DiscordButton",
		Size = UDim2.new(0, 150, 0, 38),
		Position = UDim2.new(0, 20, 1, -55),
		BackgroundColor3 = Color3.fromRGB(88, 101, 242),
		Text = "Copy Discord Link",
		TextColor3 = Color3.fromRGB(255, 255, 255),
		TextSize = 13,
		Font = Enum.Font.GothamBold,
		BorderSizePixel = 0,
		AutoButtonColor = false,
		ZIndex = 1002,
		Parent = popup
	})
	
	fastNew("UICorner", {
		Name = "DiscordCorner",
		CornerRadius = UDim.new(0, 8),
		Parent = discordBtn
	})
	
	-- Close button
	local closeBtn = fastNew("TextButton", {
		Name = "CloseButton",
		Size = UDim2.new(0, 150, 0, 38),
		Position = UDim2.new(1, -170, 1, -55),
		BackgroundColor3 = Color3.fromRGB(60, 60, 60),
		Text = "Close",
		TextColor3 = Color3.fromRGB(255, 255, 255),
		TextSize = 14,
		Font = Enum.Font.GothamBold,
		BorderSizePixel = 0,
		AutoButtonColor = false,
		ZIndex = 1002,
		Parent = popup
	})
	
	fastNew("UICorner", {
		Name = "CloseCorner",
		CornerRadius = UDim.new(0, 8),
		Parent = closeBtn
	})
	
	-- Button hover effects
	discordBtn.MouseEnter:Connect(function()
		discordBtn.BackgroundColor3 = Color3.fromRGB(78, 91, 232)
	end)
	
	discordBtn.MouseLeave:Connect(function()
		discordBtn.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
	end)
	
	closeBtn.MouseEnter:Connect(function()
		closeBtn.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
	end)
	
	closeBtn.MouseLeave:Connect(function()
		closeBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
	end)
	
	-- Copy Discord link functionality (placeholder link)
	discordBtn.MouseButton1Click:Connect(function()
		local discordLink = "https://discord.gg/yourserver"
		setclipboard(discordLink)
		discordBtn.Text = "Copied!"
		task.wait(1.5)
		discordBtn.Text = "Copy Discord Link"
	end)
	
	-- Close popup
	local function closePopup()
		backdrop:Destroy()
	end
	
	closeBtn.MouseButton1Click:Connect(closePopup)
	backdrop.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			closePopup()
		end
	end)
	
	return backdrop
end

-- Added random name generator for anti-detection
local function randomName()
	local chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"
	local length = math.random(8, 12)
	local name = ""
	for i = 1, length do
		local randIndex = math.random(1, #chars)
		name = name .. chars:sub(randIndex, randIndex)
	end
	return name
end

function WindUI:CreateWindow(options)
	local self = setmetatable({}, WindUI)
	
	options = options or {}
	local title = options.Title or "Wind UI Library"
	-- Support both UDim2 and table for size
	local size
	if typeof(options.Size) == "UDim2" then
		size = {options.Size.X.Offset, options.Size.Y.Offset}
	else
		size = options.Size or {950, 550}
	end
	
	local player = Players.LocalPlayer
	local playerGui = player:WaitForChild("PlayerGui")
	
	-- Create ScreenGui
	self.ScreenGui = fastNew("ScreenGui", {
		Name = randomName(),
		ResetOnSpawn = false,
		ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
		Parent = playerGui
	})
	
	-- Store ScreenGui reference for popup creation
	self._screenGui = self.ScreenGui

	-- Main Frame
	self.MainFrame = fastNew("Frame", {
		Name = randomName(),
		Size = UDim2.new(0, size[1], 0, size[2]),
		Position = UDim2.new(0.5, -size[1]/2, 0.5, -size[2]/2),
		BackgroundColor3 = Color3.fromRGB(32, 32, 32),
		BorderSizePixel = 0,
		ClipsDescendants = false,
		Active = true,
		Visible = true,
		Parent = self.ScreenGui
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(0, 12),
		Parent = self.MainFrame
	})
	
	-- Title Bar
	local titleBar = fastNew("Frame", {
		Name = randomName(),
		Size = UDim2.new(1, 0, 0, 50),
		BackgroundColor3 = Color3.fromRGB(45, 45, 45),
		BorderSizePixel = 0,
		Active = true,
		Parent = self.MainFrame
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(0, 12),
		Parent = titleBar
	})
	
	fastNew("Frame", {
		Name = randomName(),
		Size = UDim2.new(1, 0, 0, 12),
		Position = UDim2.new(0, 0, 1, -12),
		BackgroundColor3 = Color3.fromRGB(45, 45, 45),
		BorderSizePixel = 0,
		Parent = titleBar
	})
	
	-- Title Text
	fastNew("TextLabel", {
		Name = randomName(),
		Size = UDim2.new(1, -150, 1, 0),
		Position = UDim2.new(0, 20, 0, 0),
		BackgroundTransparency = 1,
		Text = title,
		TextColor3 = Color3.fromRGB(255, 255, 255),
		TextSize = 18,
		Font = Enum.Font.GothamBold,
		TextXAlignment = Enum.TextXAlignment.Left,
		Parent = titleBar
	})
	
	-- Close Button
	local closeBtn = fastNew("TextButton", {
		Name = randomName(),
		Size = UDim2.new(0, 38, 0, 38),
		Position = UDim2.new(1, -48, 0, 6),
		BackgroundColor3 = Color3.fromRGB(55, 55, 55),
		Text = "Ã—",
		TextColor3 = Color3.fromRGB(255, 255, 255),
		TextSize = 24,
		Font = Enum.Font.GothamBold,
		BorderSizePixel = 0,
		AutoButtonColor = false,
		Parent = titleBar
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(0, 8),
		Parent = closeBtn
	})
	
	-- Minimize Button
	local minimizeBtn = fastNew("TextButton", {
		Name = randomName(),
		Size = UDim2.new(0, 38, 0, 38),
		Position = UDim2.new(1, -92, 0, 6),
		BackgroundColor3 = Color3.fromRGB(55, 55, 55),
		Text = "âˆ’",
		TextColor3 = Color3.fromRGB(255, 255, 255),
		TextSize = 22,
		Font = Enum.Font.GothamBold,
		BorderSizePixel = 0,
		AutoButtonColor = false,
		Parent = titleBar
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(0, 8),
		Parent = minimizeBtn
	})
	
	-- Floating Minimize Button
	local floatingBtn = fastNew("TextButton", {
		Name = randomName(),
		Size = UDim2.new(0, 180, 0, 45),
		Position = UDim2.new(0.5, -90, 0, 15),
		BackgroundColor3 = Color3.fromRGB(45, 45, 45),
		BackgroundTransparency = 0.2,
		BorderSizePixel = 0,
		Visible = false,
		Active = true,
		Text = "",
		AutoButtonColor = false,
		Parent = self.ScreenGui
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(0, 12),
		Parent = floatingBtn
	})
	
	-- RGB Border
	local rgbBorder = fastNew("UIStroke", {
		Name = randomName(),
		Thickness = 4,
		Color = Color3.fromRGB(255, 0, 0),
		Transparency = 0,
		Parent = floatingBtn
	})
	
	-- RGB Animation
	task.spawn(function()
		local hue = 0
		while floatingBtn and floatingBtn.Parent do
			hue = (hue + 2) % 360
			if rgbBorder then
				rgbBorder.Color = Color3.fromHSV(hue / 360, 1, 1)
			end
			task.wait(0.02)
		end
	end)
	
	fastNew("TextLabel", {
		Name = randomName(),
		Size = UDim2.new(1, -30, 1, 0),
		Position = UDim2.new(0, 15, 0, 0),
		BackgroundTransparency = 1,
		Text = title,
		TextColor3 = Color3.fromRGB(255, 255, 255),
		TextSize = 16,
		Font = Enum.Font.GothamBold,
		TextXAlignment = Enum.TextXAlignment.Center,
		ZIndex = 2,
		Parent = floatingBtn
	})
	
	-- Tab Container (width reverted, scrollbar effectively invisible)
	self.TabContainer = fastNew("ScrollingFrame", {
		Name = randomName(),
		Size = UDim2.new(0, 140, 1, -60),
		Position = UDim2.new(0, 10, 0, 60),
		BackgroundColor3 = Color3.fromRGB(38, 38, 38),
		BorderSizePixel = 0,
		ClipsDescendants = true,
		ScrollBarThickness = 0.01, -- as requested
		ScrollBarImageTransparency = 1, -- invisible
		CanvasSize = UDim2.new(0, 0, 0, 0),
		ScrollingDirection = Enum.ScrollingDirection.Y,
		AutomaticCanvasSize = Enum.AutomaticSize.Y,
		ZIndex = 10,
		Parent = self.MainFrame
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(0, 10),
		Parent = self.TabContainer
	})
	
	local tabLayout = fastNew("UIListLayout", {
		Name = randomName(),
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 8),
		Parent = self.TabContainer
	})
	
	-- Auto-update canvas size when tabs are added
	tabLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		self.TabContainer.CanvasSize = UDim2.new(0, 0, 0, tabLayout.AbsoluteContentSize.Y + 20)
	end)
	
	fastNew("UIPadding", {
		Name = randomName(),
		PaddingTop = UDim.new(0, 10),
		PaddingBottom = UDim.new(0, 10),
		PaddingLeft = UDim.new(0, 10),
		PaddingRight = UDim.new(0, 10),
		Parent = self.TabContainer
	})
	
	-- Tab Content Container (re-aligned to original tab width)
	self.TabContentContainer = fastNew("Frame", {
		Name = randomName(),
		Size = UDim2.new(1, -160, 1, -70),
		Position = UDim2.new(0, 155, 0, 60),
		BackgroundTransparency = 1,
		BorderSizePixel = 0,
		ClipsDescendants = true,
		ZIndex = 5,
		Parent = self.MainFrame
	})
	
	-- Dragging for Main Frame
	local dragging = false
	local dragInput
	local dragStart
	local startPos
	
	local function update(input)
		local delta = input.Position - dragStart
		self.MainFrame.Position = UDim2.new(
			startPos.X.Scale,
			startPos.X.Offset + delta.X,
			startPos.Y.Scale,
			startPos.Y.Offset + delta.Y
		)
	end
	
	titleBar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = self.MainFrame.Position
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	
	titleBar.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)
	
	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			update(input)
		end
	end)
	
	-- Dragging for Floating Button
	local floatingDragging = false
	local floatingDragInput
	local floatingDragStart
	local floatingStartPos
	local floatingMouseMoved = false
	
	local function updateFloating(input)
		local delta = input.Position - floatingDragStart
		if math.abs(delta.X) > 5 or math.abs(delta.Y) > 5 then
			floatingMouseMoved = true
		end
		floatingBtn.Position = UDim2.new(
			floatingStartPos.X.Scale,
			floatingStartPos.X.Offset + delta.X,
			floatingStartPos.Y.Scale,
			floatingStartPos.Y.Offset + delta.Y
		)
	end
	
	floatingBtn.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			floatingDragging = true
			floatingDragStart = input.Position
			floatingStartPos = floatingBtn.Position
			floatingMouseMoved = false
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					floatingDragging = false
				end
			end)
		end
	end)
	
	floatingBtn.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			floatingDragInput = input
		end
	end)
	
	UserInputService.InputChanged:Connect(function(input)
		if input == floatingDragInput and floatingDragging then
			updateFloating(input)
		end
	end)
	
	-- Close Button
	closeBtn.MouseButton1Click:Connect(function()
		self.MainFrame.Visible = false
		floatingBtn.Visible = false
	end)
	
	closeBtn.MouseEnter:Connect(function()
		closeBtn.BackgroundColor3 = Color3.fromRGB(196, 43, 28)
	end)
	
	closeBtn.MouseLeave:Connect(function()
		closeBtn.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
	end)
	
	-- Minimize Button
	minimizeBtn.MouseButton1Click:Connect(function()
		self.MainFrame.Visible = false
		floatingBtn.Visible = true
	end)
	
	minimizeBtn.MouseEnter:Connect(function()
		minimizeBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
	end)
	
	minimizeBtn.MouseLeave:Connect(function()
		minimizeBtn.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
	end)
	
	-- Floating Button
	floatingBtn.MouseButton1Click:Connect(function()
		if not floatingMouseMoved then
			floatingBtn.Visible = false
			self.MainFrame.Visible = true
		end
	end)
	
	floatingBtn.MouseEnter:Connect(function()
		floatingBtn.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
		floatingBtn.BackgroundTransparency = 0.15
	end)
	
	floatingBtn.MouseLeave:Connect(function()
		floatingBtn.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
		floatingBtn.BackgroundTransparency = 0.2
	end)
	
	self.Tabs = {}
	self.CurrentTab = nil
	
	-- Store MainFrame reference for popup positioning
	self._mainFrame = self.MainFrame
	
	return self
end

-- Added Tab method as alias for CreateTab
function WindUI:Tab(options)
	return self:CreateTab(options)
end

-- Added CreateTab method to window object
function WindUI:CreateTab(options)
	options = options or {}
	local name = options.Name or options.Title or "Tab"
	-- Get icon, will be nil if not found
	local icon = getIcon(options.Icon)
	-- Added Locked parameter for locked tabs
	local locked = options.Locked or false
	
	-- Tab button
	local tabButton = fastNew("TextButton", {
		Name = randomName(),
		Size = UDim2.new(1, 0, 0, 45),
		BackgroundColor3 = Color3.fromRGB(45, 45, 45),
		Text = "",
		BorderSizePixel = 0,
		AutoButtonColor = false,
		ZIndex = 11,
		Parent = self.TabContainer
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(0, 8),
		Parent = tabButton
	})
	
	-- Only create icon label if icon exists
	local iconLabel
	if icon then
		iconLabel = fastNew("TextLabel", {
			Name = randomName(),
			Size = UDim2.new(0, 25, 1, 0),
			Position = UDim2.new(0, 10, 0, 0),
			BackgroundTransparency = 1,
			Text = icon,
			TextColor3 = Color3.fromRGB(200, 200, 200),
			TextSize = 18,
			Font = Enum.Font.GothamBold,
			ZIndex = 12,
			Parent = tabButton
		})
	end
	
	-- Text
	local textLabel = fastNew("TextLabel", {
		Name = randomName(),
		BackgroundTransparency = 1,
		Text = name,
		TextColor3 = Color3.fromRGB(255, 255, 255),
		TextSize = 14,
		Font = Enum.Font.GothamMedium,
		TextYAlignment = Enum.TextYAlignment.Center,
		ZIndex = 12,
		Parent = tabButton
	})
	if icon then
		textLabel.Size = UDim2.new(1, -45, 1, 0)
		textLabel.Position = UDim2.new(0, 40, 0, 0)
		textLabel.TextXAlignment = Enum.TextXAlignment.Left
	else
		textLabel.Size = UDim2.new(1, -20, 1, 0)
		textLabel.Position = UDim2.new(0, 10, 0, 0)
		textLabel.TextXAlignment = Enum.TextXAlignment.Center
	end
	
	-- Lock icon for locked tabs
	if locked then
		fastNew("TextLabel", {
			Name = randomName(),
			Size = UDim2.new(0, 20, 0, 20),
			Position = UDim2.new(1, -25, 0.5, -10),
			BackgroundTransparency = 1,
			Text = "ğŸ”’",
			TextColor3 = Color3.fromRGB(200, 200, 200),
			TextSize = 14,
			Font = Enum.Font.GothamBold,
			ZIndex = 12,
			Parent = tabButton
		})
	}
	
	-- Tab content
	local tabContent = fastNew("ScrollingFrame", {
		Name = name .. "Content",
		Size = UDim2.new(1, 0, 1, 0),
		Position = UDim2.new(0, 0, 0, 0),
		BackgroundTransparency = 1,
		BorderSizePixel = 0,
		ScrollBarThickness = 0,
		CanvasSize = UDim2.new(0, 0, 0, 0),
		ScrollingDirection = Enum.ScrollingDirection.Y,
		Visible = false,
		ZIndex = 6,
		Parent = self.TabContentContainer
	})
	
	local tabContentLayout = fastNew("UIListLayout", {
		Name = randomName(),
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 12),
		Parent = tabContent
	})
	
	tabContentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		tabContent.CanvasSize = UDim2.new(0, 0, 0, tabContentLayout.AbsoluteContentSize.Y + 15)
	end)
	
	local tab = {
		Button = tabButton,
		Content = tabContent,
		Icon = iconLabel,
		Text = textLabel,
		Name = name,
		Locked = locked
	}
	
	self.Tabs[name] = tab
	
	-- Tab button behavior
	tabButton.MouseButton1Click:Connect(function()
		if locked then
			if self.ScreenGui and self._mainFrame then
				createPremiumPopup(self.ScreenGui, self._mainFrame)
			end
			return
		end
		
		for _, t in pairs(self.Tabs) do
			t.Button.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
			if t.Icon then
				t.Icon.TextColor3 = Color3.fromRGB(200, 200, 200)
			end
			t.Text.TextColor3 = Color3.fromRGB(255, 255, 255)
			t.Content.Visible = false
		end
		
		tabButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
		if iconLabel then
			iconLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
		end
		textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
		tabContent.Visible = true
		self.CurrentTab = name
	end)
	
	tabButton.MouseEnter:Connect(function()
		if not locked and self.CurrentTab ~= name then
			tabButton.BackgroundColor3 = Color3.fromRGB(55, 55, 55)
		end
	end)
	
	tabButton.MouseLeave:Connect(function()
		if not locked and self.CurrentTab ~= name then
			tabButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
		end
	end)
	
	-- Auto-select first tab that is not locked
	if not self.CurrentTab and not locked then
		tabButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
		if iconLabel then
			iconLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
		end
		textLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
		tabContent.Visible = true
		self.CurrentTab = name
	end
	
	-- Return tab object with component creation methods
	return setmetatable({
		Content = tabContent,
		Name = name
	}, {__index = {
		Label = function(_, options)
			return createLabel(options, tabContent)
		end,
		Button = function(_, options)
			options._screenGui = self.ScreenGui
			options._mainFrame = self._mainFrame
			return createButton(options, tabContent)
		end,
		Toggle = function(_, options)
			options._screenGui = self.ScreenGui
			options._mainFrame = self._mainFrame
			return createToggle(options, tabContent)
		end,
		Slider = function(_, options)
			return createSlider(options, tabContent)
		end,
		Dropdown = function(_, options)
			return createDropdown(options, tabContent)
		end,
		CreateLabel = function(_, options)
			return createLabel(options, tabContent)
		end,
		CreateButton = function(_, options)
			options._screenGui = self.ScreenGui
			options._mainFrame = self._mainFrame
			return createButton(options, tabContent)
		end,
		CreateToggle = function(_, options)
			options._screenGui = self.ScreenGui
			options._mainFrame = self._mainFrame
			return createToggle(options, tabContent)
		end,
		CreateSlider = function(_, options)
			return createSlider(options, tabContent)
		end,
		CreateDropdown = function(_, options)
			return createDropdown(options, tabContent)
		end
	}})
end

-- Component creation helper functions
function createLabel(options, parent)
	options = options or {}
	local text = options.Text or "Label"
	
	return fastNew("TextLabel", {
		Name = randomName(),
		Size = UDim2.new(1, 0, 0, 25),
		BackgroundTransparency = 1,
		Text = text,
		TextColor3 = Color3.fromRGB(180, 180, 180),
		TextSize = 13,
		Font = Enum.Font.GothamBold,
		TextXAlignment = Enum.TextXAlignment.Left,
		ZIndex = 2,
		Parent = parent
	})
end

function createButton(options, parent)
	options = options or {}
	local text = options.Name or options.Title or "Button"
	local callback = options.Callback
	local locked = options.Locked or false
	local screenGui = options._screenGui
	local mainFrame = options._mainFrame
	
	local button = fastNew("TextButton", {
		Name = randomName(),
		Size = UDim2.new(0, 200, 0, 38),
		BackgroundColor3 = locked and Color3.fromRGB(60, 60, 60) or Color3.fromRGB(0, 120, 215),
		Text = text,
		TextColor3 = locked and Color3.fromRGB(120, 120, 120) or Color3.fromRGB(255, 255, 255),
		TextSize = 15,
		Font = Enum.Font.GothamMedium,
		BorderSizePixel = 0,
		AutoButtonColor = false,
		ZIndex = 2,
		Parent = parent
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(0, 8),
		Parent = button
	})
	
	if locked then
		fastNew("TextLabel", {
			Name = randomName(),
			Size = UDim2.new(0, 20, 0, 20),
			Position = UDim2.new(1, -30, 0.5, -10),
			BackgroundTransparency = 1,
			Text = "ğŸ”’",
			TextColor3 = Color3.fromRGB(120, 120, 120),
			TextSize = 14,
			Font = Enum.Font.Gotham,
			ZIndex = 3,
			Parent = button
		})
		
		button.MouseButton1Click:Connect(function()
			if screenGui and mainFrame then
				createPremiumPopup(screenGui, mainFrame)
			end
		end)
	else
		button.MouseEnter:Connect(function()
			button.BackgroundColor3 = Color3.fromRGB(0, 100, 190)
		end)
		button.MouseLeave:Connect(function()
			button.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
		end)
		button.MouseButton1Down:Connect(function()
			TweenService:Create(button, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
				Size = UDim2.new(0, 190, 0, 36)
			}):Play()
		end)
		button.MouseButton1Up:Connect(function()
			TweenService:Create(button, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
				Size = UDim2.new(0, 200, 0, 38)
			}):Play()
		end)
		if callback then
			button.MouseButton1Click:Connect(callback)
		end
	end
	
	return button
end

function createToggle(options, parent)
	options = options or {}
	local text = options.Name or options.Title or "Toggle"
	local default = options.Default or false
	local callback = options.Callback
	local locked = options.Locked or false
	local screenGui = options._screenGui
	local mainFrame = options._mainFrame
	
	local toggleFrame = fastNew("Frame", {
		Name = randomName(),
		Size = UDim2.new(1, 0, 0, 40),
		BackgroundColor3 = Color3.fromRGB(45, 45, 45),
		BorderSizePixel = 0,
		ZIndex = 2,
		Parent = parent
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(0, 8),
		Parent = toggleFrame
	})
	
	local clickDetector = fastNew("TextButton", {
		Name = randomName(),
		Size = UDim2.new(1, 0, 1, 0),
		BackgroundTransparency = 1,
		Text = "",
		ZIndex = 3,
		Parent = toggleFrame
	})
	
	local label = fastNew("TextLabel", {
		Name = randomName(),
		Size = locked and UDim2.new(1, -95, 1, 0) or UDim2.new(1, -70, 1, 0),
		Position = UDim2.new(0, 15, 0, 0),
		BackgroundTransparency = 1,
		Text = text,
		TextColor3 = Color3.fromRGB(255, 255, 255),
		TextSize = 15,
		Font = Enum.Font.Gotham,
		TextXAlignment = Enum.TextXAlignment.Left,
		ZIndex = 3,
		Parent = toggleFrame
	})
	
	if locked then
		fastNew("TextLabel", {
			Name = randomName(),
			Size = UDim2.new(0, 20, 0, 20),
			Position = UDim2.new(1, -85, 0.5, -10),
			BackgroundTransparency = 1,
			Text = "ğŸ”’",
			TextColor3 = Color3.fromRGB(200, 200, 200),
			TextSize = 14,
			Font = Enum.Font.GothamBold,
			ZIndex = 3,
			Parent = toggleFrame
		})
	end
	
	local toggleButton = fastNew("Frame", {
		Name = randomName(),
		Size = UDim2.new(0, 50, 0, 24),
		Position = UDim2.new(1, -60, 0.5, -12),
		BackgroundColor3 = Color3.fromRGB(60, 60, 60),
		BorderSizePixel = 0,
		ZIndex = 3,
		Parent = toggleFrame
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(1, 0),
		Parent = toggleButton
	})
	
	local toggleCircle = fastNew("Frame", {
		Name = randomName(),
		Size = UDim2.new(0, 20, 0, 20),
		Position = UDim2.new(0, 2, 0.5, -10),
		BackgroundColor3 = Color3.fromRGB(220, 220, 220),
		BorderSizePixel = 0,
		ZIndex = 4,
		Parent = toggleButton
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(1, 0),
		Parent = toggleCircle
	})
	
	local toggled = default
	
	local function updateToggle(animate)
		local tweenInfo = TweenInfo.new(animate and 0.2 or 0, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
		if toggled then
			TweenService:Create(toggleButton, tweenInfo, {BackgroundColor3 = Color3.fromRGB(0, 120, 215)}):Play()
			TweenService:Create(toggleCircle, tweenInfo, {Position = UDim2.new(1, -22, 0.5, -10)}):Play()
		else
			TweenService:Create(toggleButton, tweenInfo, {BackgroundColor3 = Color3.fromRGB(60, 60, 60)}):Play()
			TweenService:Create(toggleCircle, tweenInfo, {Position = UDim2.new(0, 2, 0.5, -10)}):Play()
		end
		if callback then
			callback(toggled)
		end
	end
	
	clickDetector.MouseButton1Click:Connect(function()
		if locked then
			if screenGui and mainFrame then
				createPremiumPopup(screenGui, mainFrame)
			end
			return
		end
		toggled = not toggled
		updateToggle(true)
	end)
	
	updateToggle(false)
	
	return toggleFrame
end

function createSlider(options, parent)
	options = options or {}
	local text = options.Name or options.Title or "Slider"
	local min = options.Min or 0
	local max = options.Max or 100
	local default = options.Default or 50
	local callback = options.Callback
	
	local sliderFrame = fastNew("Frame", {
		Name = randomName(),
		Size = UDim2.new(1, 0, 0, 55),
		BackgroundColor3 = Color3.fromRGB(45, 45, 45),
		BorderSizePixel = 0,
		ZIndex = 2,
		Parent = parent
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(0, 8),
		Parent = sliderFrame
	})
	
	fastNew("TextLabel", {
		Name = randomName(),
		Size = UDim2.new(1, -60, 0, 20),
		Position = UDim2.new(0, 15, 0, 8),
		BackgroundTransparency = 1,
		Text = text,
		TextColor3 = Color3.fromRGB(255, 255, 255),
		TextSize = 15,
		Font = Enum.Font.Gotham,
		TextXAlignment = Enum.TextXAlignment.Left,
		ZIndex = 3,
		Parent = sliderFrame
	})
	
	local valueLabel = fastNew("TextLabel", {
		Name = randomName(),
		Size = UDim2.new(0, 50, 0, 20),
		Position = UDim2.new(1, -60, 0, 8),
		BackgroundTransparency = 1,
		Text = tostring(default),
		TextColor3 = Color3.fromRGB(0, 120, 215),
		TextSize = 15,
		Font = Enum.Font.GothamBold,
		TextXAlignment = Enum.TextXAlignment.Right,
		ZIndex = 3,
		Parent = sliderFrame
	})
	
	local sliderHitbox = fastNew("Frame", {
		Name = randomName(),
		Size = UDim2.new(1, -30, 0, 30),
		Position = UDim2.new(0, 15, 1, -33),
		BackgroundTransparency = 1,
		ZIndex = 3,
		Parent = sliderFrame
	})
	
	local sliderTrack = fastNew("Frame", {
		Name = randomName(),
		Size = UDim2.new(1, 0, 0, 6),
		Position = UDim2.new(0, 0, 0.5, -3),
		BackgroundColor3 = Color3.fromRGB(60, 60, 60),
		BorderSizePixel = 0,
		ZIndex = 3,
		Parent = sliderHitbox
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(1, 0),
		Parent = sliderTrack
	})
	
	local sliderFill = fastNew("Frame", {
		Name = randomName(),
		Size = UDim2.new((default - min) / (max - min), 0, 1, 0),
		BackgroundColor3 = Color3.fromRGB(0, 120, 215),
		BorderSizePixel = 0,
		ZIndex = 3,
		Parent = sliderTrack
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(1, 0),
		Parent = sliderFill
	})
	
	local sliderButton = fastNew("TextButton", {
		Name = randomName(),
		Size = UDim2.new(0, 16, 0, 16),
		Position = UDim2.new((default - min) / (max - min), -8, 0.5, -8),
		BackgroundColor3 = Color3.fromRGB(255, 255, 255),
		Text = "",
		BorderSizePixel = 0,
		AutoButtonColor = false,
		ZIndex = 4,
		Parent = sliderTrack
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(1, 0),
		Parent = sliderButton
	})
	
	local currentValue = default
	local sliding = false
	
	local function updateSlider(input)
		local relativeX = math.clamp((input.Position.X - sliderTrack.AbsolutePosition.X) / sliderTrack.AbsoluteSize.X, 0, 1)
		currentValue = math.floor(min + (max - min) * relativeX)
		valueLabel.Text = tostring(currentValue)
		sliderFill.Size = UDim2.new(relativeX, 0, 1, 0)
		sliderButton.Position = UDim2.new(relativeX, -8, 0.5, -8)
		if callback then
			callback(currentValue)
		end
	end
	
	sliderButton.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			sliding = true
		end
	end)
	
	UserInputService.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			if sliding then
				sliding = false
			end
		end
	end)
	
	UserInputService.InputChanged:Connect(function(input)
		if sliding and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
			updateSlider(input)
		end
	end)
	
	sliderHitbox.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			sliding = true
			updateSlider(input)
		end
	end)
	
	return sliderFrame
end

function createDropdown(options, parent)
	options = options or {}
	local text = options.Name or options.Title or "Dropdown"
	local dropdownOptions = options.Options or {"Option 1", "Option 2"}
	local callback = options.Callback
	
	local dropdownFrame = fastNew("Frame", {
		Name = randomName(),
		Size = UDim2.new(1, 0, 0, 40),
		BackgroundColor3 = Color3.fromRGB(45, 45, 45),
		BorderSizePixel = 0,
		ClipsDescendants = false,
		ZIndex = 200,
		Parent = parent
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(0, 8),
		Parent = dropdownFrame
	})
	
	local dropdownButton = fastNew("TextButton", {
		Name = randomName(),
		Size = UDim2.new(1, 0, 0, 40),
		BackgroundTransparency = 1,
		Text = "",
		ZIndex = 201,
		Parent = dropdownFrame
	})
	
	local label = fastNew("TextLabel", {
		Name = randomName(),
		Size = UDim2.new(1, -40, 1, 0),
		Position = UDim2.new(0, 15, 0, 0),
		BackgroundTransparency = 1,
		Text = text,
		TextColor3 = Color3.fromRGB(255, 255, 255),
		TextSize = 15,
		Font = Enum.Font.Gotham,
		TextXAlignment = Enum.TextXAlignment.Left,
		ZIndex = 201,
		Parent = dropdownFrame
	})
	
	local arrow = fastNew("TextLabel", {
		Name = randomName(),
		Size = UDim2.new(0, 30, 1, 0),
		Position = UDim2.new(1, -35, 0, 0),
		BackgroundTransparency = 1,
		Text = "â–¼",
		TextColor3 = Color3.fromRGB(200, 200, 200),
		TextSize = 14,
		Font = Enum.Font.Gotham,
		ZIndex = 201,
		Parent = dropdownFrame
	})
	
	local optionsFrame = fastNew("ScrollingFrame", {
		Name = randomName(),
		Size = UDim2.new(1, 0, 0, 0),
		Position = UDim2.new(0, 0, 1, 5),
		BackgroundColor3 = Color3.fromRGB(45, 45, 45),
		BorderSizePixel = 0,
		Visible = false,
		ClipsDescendants = true,
		ScrollBarThickness = 4,
		ScrollBarImageColor3 = Color3.fromRGB(0, 120, 215),
		ZIndex = 300,
		ScrollingEnabled = true,
		Parent = dropdownFrame
	})
	
	fastNew("UICorner", {
		Name = randomName(),
		CornerRadius = UDim.new(0, 8),
		Parent = optionsFrame
	})
	
	local optionsLayout = fastNew("UIListLayout", {
		Name = randomName(),
		SortOrder = Enum.SortOrder.LayoutOrder,
		Parent = optionsFrame
	})
	
	local expanded = false
	local originalCanvasSize = parent.CanvasSize
	
	dropdownButton.MouseButton1Click:Connect(function()
		expanded = not expanded
		
		if expanded then
			optionsFrame.Visible = true
			local targetHeight = math.min(#dropdownOptions * 35, 157)
			
			local dropdownAbsolutePos = dropdownFrame.AbsolutePosition.Y + dropdownFrame.AbsoluteSize.Y
			local parentAbsoluteBottom = parent.AbsolutePosition.Y + parent.AbsoluteSize.Y
			local extraSpaceNeeded = math.max(0, (dropdownAbsolutePos + targetHeight + 5) - parentAbsoluteBottom)
			
			if extraSpaceNeeded > 0 then
				parent.CanvasSize = UDim2.new(0, 0, 0, parent.CanvasSize.Y.Offset + extraSpaceNeeded + 20)
			end
			
			TweenService:Create(optionsFrame, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {
				Size = UDim2.new(1, 0, 0, targetHeight)
			}):Play()
			arrow.Text = "â–²"
		else
			local layout = parent:FindFirstChildOfClass("UIListLayout")
			if layout then
				parent.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 15)
			end
			
			local tween = TweenService:Create(optionsFrame, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {
				Size = UDim2.new(1, 0, 0, 0)
			})
			tween:Play()
			tween.Completed:Connect(function()
				optionsFrame.Visible = false
			end)
			arrow.Text = "â–¼"
		end
	end)
	
	for _, option in ipairs(dropdownOptions) do
		local optionButton = fastNew("TextButton", {
			Name = randomName(),
			Size = UDim2.new(1, 0, 0, 35),
			BackgroundColor3 = Color3.fromRGB(45, 45, 45),
			Text = option,
			TextColor3 = Color3.fromRGB(255, 255, 255),
			TextSize = 14,
			Font = Enum.Font.Gotham,
			BorderSizePixel = 0,
			AutoButtonColor = false,
			ZIndex = 301,
			Parent = optionsFrame
		})
		
		optionButton.MouseEnter:Connect(function()
			optionButton.BackgroundColor3 = Color3.fromRGB(0, 120, 215)
		end)
		optionButton.MouseLeave:Connect(function()
			optionButton.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
		end)
		optionButton.MouseButton1Click:Connect(function()
			label.Text = option
			expanded = false
			
			local layout = parent:FindFirstChildOfClass("UIListLayout")
			if layout then
				parent.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 15)
			end
			
			local tween = TweenService:Create(optionsFrame, TweenInfo.new(0.2, Enum.EasingStyle.Quad), {
				Size = UDim2.new(1, 0, 0, 0)
			})
			tween:Play()
			tween.Completed:Connect(function()
				optionsFrame.Visible = false
			end)
			arrow.Text = "â–¼"
			
			if callback then
				callback(option)
			end
		end)
	end
	
	optionsFrame.CanvasSize = UDim2.new(0, 0, 0, #dropdownOptions * 35)
	
	return dropdownFrame
end

-- Return library table for loadstring usage
return WindUI
